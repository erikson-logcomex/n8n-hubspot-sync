apiVersion: v1
kind: ConfigMap
metadata:
  name: n8n-production-complete-dashboard
  namespace: monitoring-new
  labels:
    grafana_dashboard: "1"
data:
  n8n-production-complete.json: |
    {
      "id": 2,
      "uid": "n8n-production-complete",
      "title": "üöÄ N8N Production Complete - App + Containers + Kubernetes",
      "tags": ["n8n", "production", "containers", "kubernetes", "complete"],
      "timezone": "browser",
      "schemaVersion": 36,
      "version": 1,
      "refresh": "30s",
      "time": {
        "from": "now-6h",
        "to": "now"
      },
      "panels": [
        {
          "id": 1,
          "type": "row",
          "title": "üìä N8N Application Health & Status",
          "gridPos": {"x": 0, "y": 0, "w": 24, "h": 1}
        },
        {
          "id": 2,
          "type": "stat",
          "title": "üîÑ Workflows Ativos",
          "gridPos": {"x": 0, "y": 1, "w": 3, "h": 4},
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "thresholds"},
              "thresholds": {
                "steps": [
                  {"color": "red", "value": 0},
                  {"color": "yellow", "value": 20},
                  {"color": "green", "value": 25}
                ]
              }
            }
          },
          "targets": [
            {"expr": "n8n_active_workflow_count", "legendFormat": "Workflows"}
          ]
        },
        {
          "id": 3,
          "type": "stat",
          "title": "‚ö° Jobs Ativos",
          "gridPos": {"x": 3, "y": 1, "w": 3, "h": 4},
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "thresholds"},
              "thresholds": {
                "steps": [
                  {"color": "green", "value": 0},
                  {"color": "yellow", "value": 5},
                  {"color": "red", "value": 20}
                ]
              }
            }
          },
          "targets": [
            {"expr": "n8n_scaling_mode_queue_jobs_active", "legendFormat": "Ativos", "refId": "A", "format": "time_series"}
          ]
        },
        {
          "id": 4,
          "type": "stat",
          "title": "‚è≥ Jobs Esperando",
          "gridPos": {"x": 6, "y": 1, "w": 3, "h": 4},
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "thresholds"},
              "thresholds": {
                "steps": [
                  {"color": "green", "value": 0},
                  {"color": "yellow", "value": 10},
                  {"color": "red", "value": 50}
                ]
              }
            }
          },
          "targets": [
            {"expr": "n8n_scaling_mode_queue_jobs_waiting", "legendFormat": "Esperando", "refId": "A", "format": "time_series"}
          ]
        },
        {
          "id": 5,
          "type": "stat",
          "title": "‚úÖ Jobs Completados",
          "gridPos": {"x": 9, "y": 1, "w": 3, "h": 4},
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "value"},
              "mappings": [{"type": "special", "options": {"pattern": "*"}, "text": "‚úÖ"}]
            }
          },
          "targets": [
            {"expr": "rate(n8n_scaling_mode_queue_jobs_completed[5m])", "legendFormat": "Completados/min", "refId": "A", "format": "time_series"}
          ]
        },
        {
          "id": 6,
          "type": "stat",
          "title": "‚ùå Jobs Falharam",
          "gridPos": {"x": 12, "y": 1, "w": 3, "h": 4},
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "thresholds"},
              "thresholds": {
                "steps": [
                  {"color": "green", "value": 0},
                  {"color": "yellow", "value": 5},
                  {"color": "red", "value": 20}
                ]
              }
            }
          },
          "targets": [
            {"expr": "rate(n8n_scaling_mode_queue_jobs_failed[5m])", "legendFormat": "Falhas/min", "refId": "A", "format": "time_series"}
          ]
        },
        {
          "id": 7,
          "type": "stat",
          "title": "üîß Vers√£o N8N",
          "gridPos": {"x": 15, "y": 1, "w": 3, "h": 4},
          "fieldConfig": {
            "defaults": {}
          },
          "targets": [
            {"expr": "n8n_version_info", "legendFormat": "v{{version}}"}
          ]
        },
        {
          "id": 8,
          "type": "stat",
          "title": "üñ•Ô∏è Sistema Online",
          "gridPos": {"x": 18, "y": 1, "w": 3, "h": 4},
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "thresholds"},
              "thresholds": {
                "steps": [
                  {"color": "red", "value": 0},
                  {"color": "green", "value": 1}
                ]
              }
            }
          },
          "targets": [
            {"expr": "up{job=\"n8n\"}", "legendFormat": "Status"}
          ]
        },
        {
          "id": 9,
          "type": "stat",
          "title": "‚è±Ô∏è Uptime",
          "gridPos": {"x": 21, "y": 1, "w": 3, "h": 4},
          "fieldConfig": {
            "defaults": {"unit": "dtdurations"}
          },
          "targets": [
            {"expr": "time() - n8n_process_start_time_seconds", "legendFormat": "Tempo Ativo"}
          ]
        },
        {
          "id": 10,
          "type": "timeseries",
          "title": "üìà Throughput de Jobs (por minuto)",
          "gridPos": {"x": 0, "y": 5, "w": 12, "h": 8},
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          },
          "targets": [
            {"expr": "rate(n8n_scaling_mode_queue_jobs_completed[1m]) * 60", "legendFormat": "‚úÖ Completados/min"},
            {"expr": "rate(n8n_scaling_mode_queue_jobs_failed[1m]) * 60", "legendFormat": "‚ùå Falhas/min"},
            {"expr": "n8n_scaling_mode_queue_jobs_active", "legendFormat": "üîÑ Ativos Agora"},
            {"expr": "n8n_scaling_mode_queue_jobs_waiting", "legendFormat": "‚è≥ Esperando Agora"}
          ]
        },
        {
          "id": 11,
          "type": "piechart",
          "title": "üéØ Status Jobs (√öltima Hora)",
          "gridPos": {"x": 12, "y": 5, "w": 12, "h": 8},
          "fieldConfig": {
            "defaults": {"unit": "short"}
          },
          "targets": [
            {"expr": "increase(n8n_scaling_mode_queue_jobs_completed[1h])", "legendFormat": "‚úÖ Completados"},
            {"expr": "increase(n8n_scaling_mode_queue_jobs_failed[1h])", "legendFormat": "‚ùå Falharam"},
            {"expr": "n8n_scaling_mode_queue_jobs_active", "legendFormat": "üîÑ Executando"},
            {"expr": "n8n_scaling_mode_queue_jobs_waiting", "legendFormat": "‚è≥ Na Fila"}
          ]
        },
        {
          "id": 12,
          "type": "row",
          "title": "üê≥ Container & Pod Monitoring",
          "gridPos": {"x": 0, "y": 13, "w": 24, "h": 1}
        },
        {
          "id": 13,
          "type": "timeseries",
          "title": "üî• CPU Usage - N8N Pods",
          "gridPos": {"x": 0, "y": 14, "w": 12, "h": 8},
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "min": 0,
              "max": 100,
              "color": {"mode": "palette-classic"}
            }
          },
          "targets": [
            {"expr": "rate(container_cpu_usage_seconds_total{namespace=\"n8n\", pod=~\"n8n-.*\", container!=\"POD\", container!=\"\"}[5m]) * 100", "legendFormat": "{{pod}} CPU %"},
            {"expr": "rate(container_cpu_usage_seconds_total{namespace=\"n8n\", pod=~\"n8n-worker-.*\", container!=\"POD\", container!=\"\"}[5m]) * 100", "legendFormat": "{{pod}} CPU %"}
          ]
        },
        {
          "id": 14,
          "type": "timeseries",
          "title": "üíæ Memory Usage - N8N Pods",
          "gridPos": {"x": 12, "y": 14, "w": 12, "h": 8},
          "fieldConfig": {
            "defaults": {
              "unit": "decbytes",
              "color": {"mode": "palette-classic"}
            }
          },
          "targets": [
            {"expr": "container_memory_usage_bytes{namespace=\"n8n\", pod=~\"n8n-.*\", container!=\"POD\", container!=\"\"}", "legendFormat": "{{pod}} Memory"},
            {"expr": "container_memory_usage_bytes{namespace=\"n8n\", pod=~\"n8n-worker-.*\", container!=\"POD\", container!=\"\"}", "legendFormat": "{{pod}} Memory"}
          ]
        },
        {
          "id": 15,
          "type": "row",
          "title": "‚ö° N8N Application Performance",
          "gridPos": {"x": 0, "y": 22, "w": 24, "h": 1}
        },
        {
          "id": 16,
          "type": "timeseries",
          "title": "üß† Memory Heap Usage",
          "gridPos": {"x": 0, "y": 23, "w": 12, "h": 8},
          "fieldConfig": {
            "defaults": {
              "unit": "decbytes",
              "color": {"mode": "palette-classic"}
            }
          },
          "targets": [
            {"expr": "n8n_nodejs_heap_size_used_bytes", "legendFormat": "Heap Usado"},
            {"expr": "n8n_nodejs_heap_size_total_bytes", "legendFormat": "Heap Total"},
            {"expr": "n8n_nodejs_external_memory_bytes", "legendFormat": "Mem√≥ria Externa"}
          ]
        },
        {
          "id": 17,
          "type": "timeseries",
          "title": "‚ö° Event Loop Performance",
          "gridPos": {"x": 12, "y": 23, "w": 12, "h": 8},
          "fieldConfig": {
            "defaults": {
              "unit": "ms",
              "color": {"mode": "palette-classic"}
            }
          },
          "targets": [
            {"expr": "n8n_nodejs_eventloop_lag_p50_seconds * 1000", "legendFormat": "P50 (Mediana)"},
            {"expr": "n8n_nodejs_eventloop_lag_p90_seconds * 1000", "legendFormat": "P90"},
            {"expr": "n8n_nodejs_eventloop_lag_p99_seconds * 1000", "legendFormat": "P99"},
            {"expr": "n8n_nodejs_eventloop_lag_max_seconds * 1000", "legendFormat": "M√°ximo"}
          ]
        }
      ]
    }