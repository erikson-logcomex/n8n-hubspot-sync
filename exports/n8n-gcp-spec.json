{
    "containers":  [
                       {
                           "args":  [
                                        "start"
                                    ],
                           "command":  [
                                           "n8n"
                                       ],
                           "env":  [
                                       {
                                           "name":  "NODE_FUNCTION_ALLOW_BUILTIN",
                                           "value":  "*"
                                       },
                                       {
                                           "name":  "NODE_FUNCTION_ALLOW_EXTERNAL",
                                           "value":  "*"
                                       },
                                       {
                                           "name":  "N8N_CUSTOM_EXTENSIONS",
                                           "value":  "/home/node/.n8n/custom"
                                       },
                                       {
                                           "name":  "DB_TYPE",
                                           "value":  "postgresdb"
                                       },
                                       {
                                           "name":  "DB_POSTGRESDB_HOST",
                                           "value":  "172.23.64.3"
                                       },
                                       {
                                           "name":  "DB_POSTGRESDB_PORT",
                                           "value":  "5432"
                                       },
                                       {
                                           "name":  "DB_POSTGRESDB_DATABASE",
                                           "value":  "n8n-postgres-db"
                                       },
                                       {
                                           "name":  "DB_POSTGRESDB_USER",
                                           "valueFrom":  {
                                                             "secretKeyRef":  {
                                                                                  "key":  "POSTGRES_NON_ROOT_USER",
                                                                                  "name":  "postgres-secret"
                                                                              }
                                                         }
                                       },
                                       {
                                           "name":  "DB_POSTGRESDB_PASSWORD",
                                           "valueFrom":  {
                                                             "secretKeyRef":  {
                                                                                  "key":  "POSTGRES_NON_ROOT_PASSWORD",
                                                                                  "name":  "postgres-secret"
                                                                              }
                                                         }
                                       },
                                       {
                                           "name":  "DB_POSTGRESDB_POOL_SIZE",
                                           "value":  "15"
                                       },
                                       {
                                           "name":  "DB_POSTGRESDB_CONNECTION_TIMEOUT",
                                           "value":  "30000"
                                       },
                                       {
                                           "name":  "DB_POSTGRESDB_IDLE_CONNECTION_TIMEOUT",
                                           "value":  "300000"
                                       },
                                       {
                                           "name":  "EXECUTIONS_MODE",
                                           "value":  "queue"
                                       },
                                       {
                                           "name":  "N8N_EXECUTIONS_MODE",
                                           "value":  "queue"
                                       },
                                       {
                                           "name":  "N8N_RUNNERS_ENABLED",
                                           "value":  "true"
                                       },
                                       {
                                           "name":  "OFFLOAD_MANUAL_EXECUTIONS_TO_WORKERS",
                                           "value":  "true"
                                       },
                                       {
                                           "name":  "QUEUE_BULL_REDIS_HOST",
                                           "value":  "redis-master.n8n.svc.cluster.local"
                                       },
                                       {
                                           "name":  "QUEUE_BULL_REDIS_PORT",
                                           "value":  "6379"
                                       },
                                       {
                                           "name":  "QUEUE_BULL_REDIS_DB",
                                           "value":  "0"
                                       },
                                       {
                                           "name":  "QUEUE_BULL_REDIS_PASSWORD",
                                           "valueFrom":  {
                                                             "secretKeyRef":  {
                                                                                  "key":  "REDIS_PASSWORD",
                                                                                  "name":  "redis-auth"
                                                                              }
                                                         }
                                       },
                                       {
                                           "name":  "N8N_REDIS_HOST",
                                           "value":  "redis-master.n8n.svc.cluster.local"
                                       },
                                       {
                                           "name":  "N8N_REDIS_PORT",
                                           "value":  "6379"
                                       },
                                       {
                                           "name":  "N8N_REDIS_PASSWORD",
                                           "valueFrom":  {
                                                             "secretKeyRef":  {
                                                                                  "key":  "REDIS_PASSWORD",
                                                                                  "name":  "redis-auth"
                                                                              }
                                                         }
                                       },
                                       {
                                           "name":  "N8N_METRICS",
                                           "value":  "true"
                                       },
                                       {
                                           "name":  "N8N_METRICS_PREFIX",
                                           "value":  "n8n_"
                                       },
                                       {
                                           "name":  "N8N_METRICS_ENDPOINT",
                                           "value":  "/metrics"
                                       },
                                       {
                                           "name":  "N8N_METRICS_INCLUDE_DEFAULT_METRICS",
                                           "value":  "true"
                                       },
                                       {
                                           "name":  "N8N_METRICS_INCLUDE_QUEUE_METRICS",
                                           "value":  "true"
                                       },
                                       {
                                           "name":  "N8N_METRICS_INCLUDE_WORKFLOW_ID_LABEL",
                                           "value":  "true"
                                       },
                                       {
                                           "name":  "N8N_METRICS_INCLUDE_WORKFLOW_NAME_LABEL",
                                           "value":  "true"
                                       },
                                       {
                                           "name":  "N8N_METRICS_INCLUDE_NODE_TYPE_LABEL",
                                           "value":  "false"
                                       },
                                       {
                                           "name":  "N8N_PROTOCOL",
                                           "value":  "https"
                                       },
                                       {
                                           "name":  "N8N_HOST",
                                           "value":  "n8n-logcomex.34-8-101-220.nip.io"
                                       },
                                       {
                                           "name":  "N8N_SECURE_COOKIE",
                                           "value":  "true"
                                       },
                                       {
                                           "name":  "N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS",
                                           "value":  "true"
                                       },
                                       {
                                           "name":  "N8N_TRUSTED_PROXIES",
                                           "value":  "redis-master.n8n.svc.cluster.local"
                                       },
                                       {
                                           "name":  "N8N_WEBHOOK_URL",
                                           "value":  "https://n8n-logcomex.34-8-101-220.nip.io"
                                       },
                                       {
                                           "name":  "N8N_EDITOR_BASE_URL",
                                           "value":  "https://n8n-logcomex.34-8-101-220.nip.io"
                                       },
                                       {
                                           "name":  "N8N_PORT",
                                           "value":  "5678"
                                       },
                                       {
                                           "name":  "WEBHOOK_URL",
                                           "value":  "https://n8n-logcomex.34-8-101-220.nip.io"
                                       },
                                       {
                                           "name":  "N8N_PUSH_BACKEND",
                                           "value":  "websocket"
                                       },
                                       {
                                           "name":  "N8N_LISTEN_ADDRESS",
                                           "value":  "0.0.0.0"
                                       },
                                       {
                                           "name":  "N8N_PUSH_BACKEND_WEBSOCKET_HEARTBEAT_INTERVAL",
                                           "value":  "30000"
                                       },
                                       {
                                           "name":  "N8N_CACHE_TTL",
                                           "value":  "3600"
                                       },
                                       {
                                           "name":  "N8N_CACHE_MAX_SIZE",
                                           "value":  "100"
                                       },
                                       {
                                           "name":  "N8N_ENCRYPTION_KEY",
                                           "valueFrom":  {
                                                             "secretKeyRef":  {
                                                                                  "key":  "N8N_ENCRYPTION_KEY",
                                                                                  "name":  "n8n-encryption"
                                                                              }
                                                         }
                                       }
                                   ],
                           "image":  "docker.n8n.io/n8nio/n8n:1.120.0",
                           "imagePullPolicy":  "IfNotPresent",
                           "livenessProbe":  {
                                                 "failureThreshold":  3,
                                                 "httpGet":  {
                                                                 "path":  "/healthz",
                                                                 "port":  5678,
                                                                 "scheme":  "HTTP"
                                                             },
                                                 "initialDelaySeconds":  120,
                                                 "periodSeconds":  20,
                                                 "successThreshold":  1,
                                                 "timeoutSeconds":  1
                                             },
                           "name":  "n8n",
                           "ports":  [
                                         {
                                             "containerPort":  5678,
                                             "protocol":  "TCP"
                                         }
                                     ],
                           "readinessProbe":  {
                                                  "failureThreshold":  3,
                                                  "httpGet":  {
                                                                  "path":  "/healthz",
                                                                  "port":  5678,
                                                                  "scheme":  "HTTP"
                                                              },
                                                  "initialDelaySeconds":  60,
                                                  "periodSeconds":  10,
                                                  "successThreshold":  1,
                                                  "timeoutSeconds":  1
                                              },
                           "resources":  {
                                             "limits":  {
                                                            "cpu":  "800m",
                                                            "memory":  "1500Mi"
                                                        },
                                             "requests":  {
                                                              "cpu":  "600m",
                                                              "memory":  "1200Mi"
                                                          }
                                         },
                           "securityContext":  {
                                                   "allowPrivilegeEscalation":  false,
                                                   "capabilities":  {
                                                                        "drop":  [
                                                                                     "ALL"
                                                                                 ]
                                                                    },
                                                   "runAsGroup":  1000,
                                                   "runAsNonRoot":  true,
                                                   "runAsUser":  1000,
                                                   "seccompProfile":  {
                                                                          "type":  "RuntimeDefault"
                                                                      }
                                               },
                           "terminationMessagePath":  "/dev/termination-log",
                           "terminationMessagePolicy":  "File",
                           "volumeMounts":  [
                                                {
                                                    "mountPath":  "/home/node/.n8n",
                                                    "name":  "n8n-claim0"
                                                },
                                                {
                                                    "mountPath":  "/home/node/.n8n/postgres",
                                                    "name":  "postgres-secret",
                                                    "readOnly":  true
                                                }
                                            ]
                       }
                   ],
    "dnsPolicy":  "ClusterFirst",
    "initContainers":  [
                           {
                               "command":  [
                                               "sh",
                                               "-c",
                                               "chown 1000:1000 /data"
                                           ],
                               "env":  [
                                           {
                                               "name":  "N8N_REDIS_HOST",
                                               "value":  "redis-master.n8n.svc.cluster.local"
                                           },
                                           {
                                               "name":  "QUEUE_BULL_REDIS_HOST",
                                               "value":  "redis-master.n8n.svc.cluster.local"
                                           }
                                       ],
                               "image":  "busybox:1.36",
                               "imagePullPolicy":  "IfNotPresent",
                               "name":  "volume-permissions",
                               "resources":  {
                                                 "limits":  {
                                                                "cpu":  "100m",
                                                                "memory":  "128Mi"
                                                            },
                                                 "requests":  {
                                                                  "cpu":  "50m",
                                                                  "memory":  "64Mi"
                                                              }
                                             },
                               "securityContext":  {
                                                       "allowPrivilegeEscalation":  false,
                                                       "capabilities":  {
                                                                            "drop":  [
                                                                                         "ALL"
                                                                                     ]
                                                                        },
                                                       "runAsNonRoot":  true,
                                                       "runAsUser":  1000,
                                                       "seccompProfile":  {
                                                                              "type":  "RuntimeDefault"
                                                                          }
                                                   },
                               "terminationMessagePath":  "/dev/termination-log",
                               "terminationMessagePolicy":  "File",
                               "volumeMounts":  [
                                                    {
                                                        "mountPath":  "/data",
                                                        "name":  "n8n-claim0"
                                                    }
                                                ]
                           }
                       ],
    "nodeSelector":  {
                         "cloud.google.com/gke-nodepool":  "pool-cpu4"
                     },
    "restartPolicy":  "Always",
    "schedulerName":  "default-scheduler",
    "securityContext":  {
                            "fsGroup":  1000,
                            "runAsGroup":  1000,
                            "runAsNonRoot":  true,
                            "runAsUser":  1000,
                            "seccompProfile":  {
                                                   "type":  "RuntimeDefault"
                                               }
                        },
    "terminationGracePeriodSeconds":  30,
    "volumes":  [
                    {
                        "name":  "n8n-claim0",
                        "persistentVolumeClaim":  {
                                                      "claimName":  "n8n-claim0"
                                                  }
                    },
                    {
                        "name":  "postgres-secret",
                        "secret":  {
                                       "defaultMode":  420,
                                       "secretName":  "postgres-secret"
                                   }
                    }
                ]
}
